<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>B-Intel | Chat room</title>
  </head>
  <body>
    <textarea  style="max-width: 90%; margin: auto;" id="chat-logLog" cols="100" rows="20" ></textarea>
    <br>
    <input id="Filer" type="file">
    <input style="max-width: 90%; margin: auto;" id="chat-message-inputLog" size="100" type="text">
    <br>
    <input id='chat-message-submitLog' type='button' value='Send'>
    <br> <br>
    <textarea readonly  style="max-width: 90%; margin: auto;" id="chat-log" cols="100" rows="20" ></textarea>
    <br>
    <input style="max-width: 90%; margin: auto;" id="chat-message-input" size="100" type="text">
    <br>
    <input id='chat-message-submit' type='button' value='Send'>
   
    <script> 
        
        //var roomName = JSON.parse(document.getElementById('room-name').textContent);
         var roomName = 3
        console.log(roomName)
       
        const chatSocket = new WebSocket(
            'ws://'
            + window.location.host
            + '/ws/chatList/'
        )
        const chatSocketRoom = new WebSocket(
            'ws://'
            + window.location.host
            + '/ws/chat/'
            + roomName 
            + '/'
        ) 
        
        chatSocket.onmessage = function (e) {
            const data = JSON.parse(e.data)
            //var val = data.message[2].ChatLog
            console.log(data)
            document.querySelector('#chat-log').value += (JSON.stringify(data.message,space = 4) + '\n')

        }
        chatSocket.onopen = () => {
            console.log('am opened websocket')
        }
        chatSocket.onclose = function (e) {
            console.log(' chat socket closed unexpectedly')
        }
        document.querySelector('#chat-message-input').focus()
        document.querySelector('#chat-message-input').onkeyup = function (e) {
            if(e.key === 'Enter') {
                document.querySelector('#chat-message-submit').onclick()

            }
        }
        document.querySelector('#chat-message-submit').onclick = function (e) {
            const messageInputdom = document.querySelector('#chat-message-input')
            const message = messageInputdom.value
            chatSocket.send(JSON.stringify({
                    'message' : message
            }))
        }

        chatSocketRoom.onmessage = function (e) {
            const data = JSON.parse(e.data)
            console.log(data)
            document.querySelector('#chat-logLog').value += (data.message + '\n')

        }
        chatSocketRoom.onopen = () => {
            console.log('am opened websocket')
        }
        chatSocketRoom.onclose = function (e) {
            console.log(' chat socket closed unexpectedly')
        }
        document.querySelector('#chat-message-inputLog').focus()
        document.querySelector('#chat-message-inputLog').onkeyup = function (e) {
            if(e.key === 'Enter') {
                document.querySelector('#chat-message-submitLog').onclick()

            }
        }
        document.querySelector('#chat-message-submitLog').onclick = function (e) {
            const messageInputdom = document.querySelector('#chat-message-inputLog')
            const message = messageInputdom.value
            // chatSocketRoom.send(JSON.stringify({ 
            //     'group_name' : '3',               
            //     'scope' : 'Groups',
            //     'sender' : 'kenji',
            //     'reciever' : 'Joe',
            //     'email' : 'joejonnes@gmail.com',
            //     'message' : message,
            //     'upload' : '',
            //     'scr' : ''
            // }))
            const File = document.querySelector('#Filer')
            const formData = new FormData()
            formData.append('file',File.files[0])

            chatSocketRoom.send(File.files[0])
        }
    </script>
  </body>
</html>
